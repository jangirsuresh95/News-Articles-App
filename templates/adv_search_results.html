<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	<title>Advanced Search Results</title>
</head>
<body>
	<form action="/adv_search" method="POST">

		<label for="search_keyword">Search Keyword:</label>
		<input type="text"  name="search_keyword" class="search-box" value="{{search_keyword}}" required><br>
		<ul class="keyword_suggs_results"></ul>
		<script>
		  $(document).ready(function() {
			let debounce;
			$('.search-box').on('keydown', function (e) { 
			  clearTimeout(debounce)
			  debounce = setTimeout(() => {
					  getAutoComplete();  
			  }, 300);
			})
		  })

		  function getAutoComplete() {
				  const query = $('.search-box').val();
				  fetch(`http://localhost:5000/auto_suggs?q=${encodeURIComponent(query.trim())}`)
					.then((resp) => resp.json())
					.then((data) => {
							$('.keyword_suggs_results').empty();
							for (let i = 0; i < data.length; i++) {
									$('.keyword_suggs_results').append(`<li>${data[i]}</li>`)
							}
						  })
		  }
		</script>
		<label for="tags">Tags:</label>
		<input type="text"  name="tags" value="{{tags}}" required><br>
		<label for="date_range">Date Range:</label>
		<input type="date" name="from_pub_date" placeholder="dd-mm-yyyy" value="{{from_pub_date}}" required>
		<input type="date" name="to_pub_date" placeholder="dd-mm-yyyy" value="{{to_pub_date}}" required><br>
		<input type="submit" class="btn btn-primary" name="submit" value="Search">

		
	</form>
	<br>
	<h3 id="total_search_results_time">About {{total_search_results}} results({{es_search_took_time}} milliseconds)</h3>
	<ul id="results">
	{% for key, value in results_dict.items() %}
		<li><a href="/read_news/{{value.news_id}}">{{ value.news_title }}</a></li>
	{% endfor %}
	</ul>
	{%if(from_result==0)%}
		<input type="hidden">

	{%else%}
		<form action="/adv_search" method="POST">
			<input type="hidden" name="search_keyword" placeholder="" value="{{search_keyword}}">
			<input type="hidden"  name="tags" value="{{tags}}">
			<input type="hidden" name="from_pub_date"  value="{{from_pub_date}}" >
			<input type="hidden" name="to_pub_date"  value="{{to_pub_date}}">
			<input type="hidden" name="prev_page" value="{{from_result}}">
			<button type="submit" class="btn btn-secondary center-block" name="submit" value="Previous Page">Previous Page</button>
			<!-- <input type="submit" name="submit" value="Previous Page"> -->
		</form>
	{%endif%}
	{%if(total_search_results==0 or len_results_dict<10)%}
		{%if(total_search_results==0)%}
			<h2>No Results Found</h2>
		{%endif%}
	{%else%}
		<br>
		<form action="/adv_search" method="POST">
			<input type="hidden" name="search_keyword" placeholder="" value="{{search_keyword}}">
			<input type="hidden"  name="tags" value="{{tags}}">
			<input type="hidden" name="from_pub_date"  value="{{from_pub_date}}" >
			<input type="hidden" name="to_pub_date"  value="{{to_pub_date}}">
			<input type="hidden" name="prev_page" value="{{from_result}}">
			<input type="hidden" name="next_page" placeholder="" value={{from_result}}>
			<button type="submit" class="btn btn-dark center-block" name="submit" value="Next Page">Next Page</button>
			<!-- <input type="submit" name="submit" value="Next Page"> -->
		</form>
	{%endif%}

</body>
</html>